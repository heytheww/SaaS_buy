# 开发说明

## redis使用示例

```
// 创建redis连接
rdb := mydb.RDB{}
// 初始化redis数据库连接和配置
err := rdb.InitRDB()
if err != nil {
	log.Fatal("redis init error:", err)
}

// 创建一个异步消息队列
err2, mq := rdb.InitMQ("mq", s.MaxMsgLen)
if err2 != nil {
	log.Fatal("redis init mq error:", err2)
}

gName := "cg1"
err3 := rdb.CreateGroup(context.Background(), &mq, gName)
if err3 != nil {
	log.Fatal("redis create group error:", err3)
}

msgLen := s.RDB.GetMsgsLen(context.Background(), mq)

// 放入消息
cmd := rdb.AddMsg(context.Background(),mq,
		"user_id", strconv.Itoa(req.User_Id),
		"product_id", strconv.Itoa(req.Product_Id),
		"name", req.Name,
		"address", req.Address,
		"phone", req.Phone,
		"remarks", req.Remarks)

if cmd.Err() != nil {
	log.Fatalln(cmd.Err())
}

// 读取消息
xs, err := rdb.GetMsgByGroup(ctx, &mq, "c1")
if err != nil {
	return err
}

// 组装字段
now := time.Now().Format("2006-01-02 15:04:05")
order := model.TableOrder{
	Status:      1,
	Create_Time: now,
	Update_Time: now,
}

messages := (*xs)[0].Messages
for _, v := range messages {
	msgId = v.ID
	for key, value := range v.Values {
		value, ok := value.(string)
		if ok {
			switch key {
			case "user_id":
				id, err := strconv.Atoi(value)
				if err != nil {
					return errors.New("user_id Atoi error")
					// fmt.Println(errors.New("user_id Atoerror"))
				}
				order.User_Id = id
			case "product_id":
				id, err := strconv.Atoi(value)
				if err != nil {
					return errors.New("product_id Atoi error")
					// fmt.Println(errors.New("product_id Atoerror"))
				}
				order.Product_Id = id
			case "name":
				order.Name = value
			case "phone":
				order.Phone = value
			case "address":
				order.Address = value
			case "remarks":
				order.Remarks = value
			}
		} else {
			return errors.New("type assertion not ok")
			// fmt.Println(errors.New("type assertion not ok"))
		}
	}
}

```
